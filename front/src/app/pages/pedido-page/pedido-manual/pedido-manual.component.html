<app-page [titulo]="pageTitulo">
    <div class="row">
        <div class="col-auto">
            <app-fieldset label="Dados Pedido">
                <div *ngIf="desabilitaCampoIDPedido" class="col-5">
                    <app-input [readonly]="true" [value]="pedido.dataPedido" specialType="dd_mm_yy_hh_mm" label="Data / Hora Pedido" />
                </div>
                <div *ngIf="desabilitaCampoIDPedido" class="col-3">
                    <app-input [readonly]="true" [value]="pedido.valor" specialType="real" label="Valor:"/>
                </div>
                <div class="col-4">
                    <app-input-select [value]="optionDefaultTipoPagamento" (valueChange)="setTipoPagamento($event)" label="Tipo Pagamento" [options]="listaTipoPagamentoOptions" />
                </div>
                <div class="col-2">
                    <app-input-checkbox id="entrega-checkbox" label="Entrega" [(value)]="pedido.entrega" (valueChange)="changeEntrega()"/>
                </div>
                <div class="col-3">
                    <app-input [readonly]="true" [value]="pedido.valorTaxa" label="Taxa:" specialType="real"/>
                </div>
            </app-fieldset>
        </div>
        <div class="col-4">
            <app-fieldset label="Ações">
                <div *ngIf="desabilitaCampoIDPedido" class="col-button">
                    <app-button-action type="imprimir" (click)="imprimir()" />
                </div>
                <div *ngIf="desabilitaCampoIDPedido" class="col-button">
                    <app-button-action type="x" (click)="cancelaPedido()" />
                </div>
                <div *ngIf="!desabilitaCampoIDPedido || pedido.status == 'CONCLUIDO'" class="col-button">
                    <app-button-action type="novo-pedido" (click)="novoPedido()" />
                </div>
                <div *ngIf="this.pedido.id != 0" class="col-button">
                    <app-button-action type="imprimir-previa" (click)="mostrarEmNovaAba()" />
                </div>
            </app-fieldset>
        </div>
    </div>
    <div class="row">
        <div class="col-auto">
            <app-fieldset label="Dados Cliente">
                <div class="col-3">
                    <app-input label="Telefone:" id="pedido-telefone" [(value)]="pedido.clienteTelefone">
                    </app-input>
                </div>
                <div class="col-button">
                    <app-button-action type="lupa" (click)="getDadosClienteByTelefone()" />
                </div>
                <div class="col-4">
                    <app-input [(value)]="pedido.clienteNome" label="Nome" (valueChange)="gravarPedido()" />
                </div>
                <div *ngIf="showSalvarCliente" class="col-1">
                    <app-button-action type="usuario-adicinar" (click)="adicionarCliente()" />
                </div>
                <div class="col-button">
                    <app-button-action type="casa" (click)="openModalEndereco()" />
                </div>
                <div class="col-auto">
                    <app-input [readonly]="true" [value]="pedido.enderecoDescricao" label="Endereço" />
                </div>
                    
            </app-fieldset>
        </div>
    </div>
    <div *ngIf="desabilitaCampoIDPedido" class="row">
        <div class="col-20">
            <app-input label="Observação:" [upperCase]="true" [(value)]="pedido.observacao"
                (valueChange)="gravarPedido()" />
        </div>
    </div>
    <div *ngIf="desabilitaCampoIDPedido" class="row">
        <div class="col-button">
            <app-button-action type="pizza" (click)="adicionaItemPedido('Pizza')" />
        </div>
        <div class="col-button">
            <app-button-action type="refrigerante" (click)="adicionaItemPedido('Bebida')" />
        </div>
    </div>
    <div class="row">
        <div class="col-auto">
            <app-fieldset label="Itens Pedido" *ngIf="desabilitaCampoIDPedido">
                <div *ngFor="let item of pedido.itensPedido; let index = index" class="row">
                    <div class="col-button">
                        <app-button-action type="remover" (click)="removerItemPedido(item.id)" />
                    </div>
                    <div class="col-button">
                        <app-button-action type="editar" (click)="openModalItem(item)" />
                    </div>
                    <div class="col-1">
                        <h2>Item {{index + 1}}:</h2>
                    </div>
                    <div class="col-2">
                        <app-input [readonly]="true" [value]="item.tipo" id="item-{{index + 1}}-tipo" label="Tipo" />
                    </div>
                    <div class="col-2">
                        <app-input [readonly]="true" [value]="item.quantidade" label="Quan." [type]="'number'"
                            id="item-{{index + 1}}-quantidade" />
                    </div>
                    <div class="col-auto">
                        <app-input [readonly]="true" [value]="item.nome != undefined ? item.nome : ''" label="Descrição"
                            id="item-{{index + 1}}-descricao" />
                    </div>
                    <div class="col-2">
                        <app-input [readonly]="true" [value]="item.tamanho != undefined ? item.tamanho : ''"
                            id="item-{{index + 1}}-tamanho" label="Tamanho" />
                    </div>
                    <div class="col-2">
                        <app-input [readonly]="true"
                            [value]="item.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })" label="Valor"
                            id="item-{{index + 1}}-valor" />
                    </div>
                </div>
            </app-fieldset>
        </div>
    </div>
    <div>
        <app-modal-endereco [telefoneCliente]="pedido.clienteTelefone" [(showModal)]="showModalEndereco"
            (showModalChange)="getDadosClienteByTelefone()">
        </app-modal-endereco>
        <app-modal-item-pizza [idPedido]="pedido.id" [idItem]="idItem" (dadosItemChange)="carregaDadosPedidoGeral()"
            [(showModal)]="showModalItemPizza">
        </app-modal-item-pizza>


        <app-modal-item-bebida [idPedido]="pedido.id" [idItem]="idItem" (dadosItemChange)="carregaDadosPedidoGeral()"
            [(showModal)]="showModalItemBebida">
        </app-modal-item-bebida>
        <app-previa-pedido [previa]="previa" [(showModal)]="showModalPrevia">
        </app-previa-pedido>
    </div>
</app-page>